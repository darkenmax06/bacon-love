---
import "./menu.css"

const {
  home, 
  about, 
  testimonials, 
  menu, 
  appointments, 
  orderLink, 
  languajes,
  links,
  lang,
  alternateLinks
} = Astro.props

const currentLang = lang || Astro.params.lang || 'es';

// Fallback logic if links are not provided (legacy support)
const getLink = (key) => {
  if (links && links[key]) return links[key];
  // Fallback to single-page anchors
  const base = `/${currentLang}`;
  if (key === 'home') return `${base}/#hero`;
  if (key === 'about') return `${base}/#about`;
  if (key === 'menu') return `${base}/#platillos`;
  if (key === 'testimonials') return `${base}/#testimonials`;
  if (key === 'appointments') return `${base}/citas`; // Or check lang for appointments slug
  return `${base}/#`;
}
---

<header class="menu">
  <div class="container">
    <a href={getLink('home')} class="menu__logo">
      <img src="/logo.png" alt="Bacon Love Logo - Bar & Grill en Madrid">
    </a>

    <div class="menu__right">
      <nav>
        <ul class="menu__list" >
          <li><a href={getLink('home')}> {home} </a></li>
          <li><a href={getLink('about')}> {about} </a></li>
          <li><a href={getLink('menu')}> {menu} </a></li>
          <li><a href={getLink('testimonials')}> {testimonials} </a></li>
          <li><a href={getLink('appointments')}> {appointments} </a></li>
          {links?.contact && <li><a href={links.contact}> Contacto </a></li>} <!-- Add Contact if available -->
          
          {orderLink && (
            <li>
              <a
                href="https://pedidos.delitbee.shop/bacon-love"
                target="_blank"
                rel="noopener noreferrer"
                class="nav-order__link"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                  <line x1="3" y1="6" x2="21" y2="6"/>
                  <path d="M16 10a4 4 0 0 1-8 0"/>
                </svg>
                {orderLink}
              </a>
            </li>
          )}
        </ul>
      </nav>

      <div class="menu__actions">
        <div class="menu__languajes">
          <span class="menu__languaje">{currentLang}</span>
          <ul>
            {languajes.map(res => (
              <li class="languajes__selectors">
                <a href={alternateLinks && alternateLinks[res] ? alternateLinks[res] : `/${res}/`}>
                  {res}
                </a>
              </li>
            ))}
          </ul>
        </div>

        <button class="menu__btn" aria-label="Toggle Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </div>
</header>
<script>
  // Mobile Menu Logic
  const $menuBtn = document.querySelector(".menu__btn")
  const $menuList = document.querySelector(".menu__list")
  const $menuListItems = document.querySelectorAll(".menu__list li")
  
  const toggleMenu = () => {
    $menuList?.classList.toggle("active")
    $menuBtn?.classList.toggle("active")
  }

  $menuBtn?.addEventListener("click", toggleMenu)

  // Lang Switcher Logic (Dropdown)
  const $menuLanguaje = document.querySelector(".menu__languajes")
  const $showLanguaje = $menuLanguaje?.firstElementChild
  const $toggleLanguajes = $menuLanguaje?.lastElementChild

  const toggleLanguajes = () => $toggleLanguajes?.classList.toggle("active")
  $showLanguaje?.addEventListener("click", toggleLanguajes)

  // Remove old JS redirect logic since we use direct links now
</script>